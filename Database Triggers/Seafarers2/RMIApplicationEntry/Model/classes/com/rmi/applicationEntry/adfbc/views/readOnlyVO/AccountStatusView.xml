<?xml version="1.0" encoding="windows-1252" ?>
<!DOCTYPE ViewObject SYSTEM "jbo_03_01.dtd">
<!---->
<ViewObject
  xmlns="http://xmlns.oracle.com/bc4j"
  Name="AccountStatusView"
  Version="12.1.3.10.47"
  InheritPersonalization="merge"
  BindingStyle="OracleName"
  CustomQuery="true"
  PageIterMode="Full">
  <DesignTime>
    <Attr Name="_isExpertMode" Value="true"/>
  </DesignTime>
  <Properties>
    <SchemaBasedProperties>
      <LABEL
        ResId="com.rmi.applicationEntry.adfbc.views.readOnlyVO.AccountStatusView_LABEL"/>
    </SchemaBasedProperties>
  </Properties>
  <Variable
    Name="pUserType"
    Kind="where"
    Type="java.lang.String"/>
  <Variable
    Name="pUserId"
    Kind="where"
    Type="java.lang.Integer"/>
  <Variable
    Name="pInvoiceNumber"
    Kind="where"
    Type="java.lang.String"/>
  <Variable
    Name="pInvoiceDate"
    Kind="where"
    Type="java.sql.Timestamp"/>
  <Variable
    Name="pWorkOrderNumber"
    Kind="where"
    Type="java.lang.String"/>
  <Variable
    Name="pInvoiceDateTo"
    Kind="where"
    Type="java.sql.Timestamp"/>
  <SQLQuery><![CDATA[select customer_trx_id, trx_number, trx_date, amount_due_original,                 
  amount_due_remaining, bill_to_customer_id, ship_date_actual,          
  due_date, work_order, purchase_order,batch_id, invoice_sent           
  from           
  (          
      SELECT customer_trx_id, trx_number,trunc(trx_date) trx_date,amount_due_original,                 
      amount_due_remaining,due_date,bill_to_customer_id,ship_date_actual,work_order,                 
      purchase_order,              
      (select esi_batch_id from rmi_seafarer.rmi_batch_iface bti, OE_ORDER_HEADERS_ALL ord              
                          where bti.oe_header_id = ord.header_id and ord.order_number = work_order) batch_id,          
      invoice_sent          
      FROM RMI_OPEN_INVOICES                    
      WHERE          
      ('External' = :pUserType   
        and 1 = (select 1 from rmi_seafarer.rmi_batch_iface bti, OE_ORDER_HEADERS_ALL ord              
                 where bti.oe_header_id = ord.header_id and ord.order_number = work_order    
                 and bti.batch_submitted_by = :pUserId)   
        and bill_to_customer_id IN (                  
                SELECT to_number(rel_cust_id)        
                  FROM ( SELECT rel_cust_id      
                          FROM (SELECT hca.cust_account_id, hca.cust_account_id rel_cust_id,      
                                       hp_ship.party_name party_name, hp_ship.party_id,      
                                          hp_ship.party_name      
                                       || '('      
                                       || hca.account_number      
                                       || ')' party_name_account      
                                  FROM hz_parties hp_ship, hz_cust_accounts hca      
                                 WHERE 1 = 1      
                                   AND hca.account_name = 'SICD'      
                                   AND hca.party_id = hp_ship.party_id      
                                UNION ALL      
                                SELECT hca.cust_account_id, hca1.cust_account_id,      
                                       hp_ship.party_name party_name, hp_ship.party_id,      
                                          hp_ship.party_name      
                                       || '('      
                                       || hca1.account_number      
                                       || ')' party_name_account      
                                  FROM hz_parties hp_ship,      
                                       hz_cust_accounts hca,      
                                       hz_cust_acct_relate_all rel,      
                                       hz_cust_accounts hca1      
                                 WHERE 1 = 1      
                                   AND hca.account_name = 'SICD'      
                                   AND hca1.party_id = hp_ship.party_id      
                                   AND hca.cust_account_id = rel.related_cust_account_id      
                                   AND hca1.cust_account_id = rel.cust_account_id      
                                   AND bill_to_flag = 'Y') qry      
                         WHERE 1 = 1      
                           AND cust_account_id in (     
                                      SELECT b.cust_account_id              
                                          FROM hz_parties a,                
                                               hz_cust_accounts b,                
                                               rmi_seafarer.rmi_user su,                
                                               rmi_seafarer.rmi_user_order_agent_map ua                
                                         WHERE a.party_id = b.party_id                
                                           AND b.cust_account_id = ua.ordering_agent_account_id                
                                           AND b.cust_account_id = ua.ordering_agent_account_id                
                                           AND ua.user_id = su.user_id(+)                
                                           AND b.status = 'A'                
                                           AND ua.user_id = :pUserId                 
                                           AND b.account_name = 'SICD'                
                                           AND 'External' = (SELECT user_type                
                                                               FROM rmi_seafarer.rmi_user                
                                                              WHERE user_id = :pUserId)                
                                        UNION                 
                                        SELECT hca.cust_account_id                
                                          FROM hz_parties hp_ship, hz_cust_accounts hca                
                                         WHERE 1 = 1                
                                           AND hca.account_name = 'SICD'                
                                           AND hca.party_id = hp_ship.party_id                
                                           AND 'Internal' = (SELECT user_type                
                                                               FROM rmi_seafarer.rmi_user                
                                                              WHERE user_id = :pUserId)     
                           )      
                           AND EXISTS (      
                                  SELECT 1      
                                    FROM hz_cust_acct_sites_all a, hz_cust_site_uses_all b      
                                   WHERE a.cust_acct_site_id = b.cust_acct_site_id      
                                     AND a.cust_account_id = qry.rel_cust_id      
                                     AND b.site_use_code = 'BILL_TO'      
                                     AND b.status = 'A'      
                                     AND a.status = 'A'))     
                      )        
                  )         
      or ('Internal' = :pUserType          
        and trx_number = nvl(:pInvoiceNumber, trx_number)          
        and trunc(trx_date) between nvl(:pInvoiceDate, trunc(trx_date)) and nvl(:pInvoiceDateTo, trunc(trx_date))  
        and work_order = nvl(:pWorkOrderNumber, work_order))          
    )          
  order by due_date desc]]></SQLQuery>
  <ViewAttribute
    Name="CustomerTrxId"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="java.lang.Integer"
    ColumnType="LONGINT"
    AliasName="CUSTOMER_TRX_ID"
    Expression="CUSTOMER_TRX_ID"
    SQLType="INTEGER"/>
  <ViewAttribute
    Name="TrxNumber"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="20"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="TRX_NUMBER"
    Expression="TRX_NUMBER"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="20"/>
    </DesignTime>
  </ViewAttribute>
  <ViewAttribute
    Name="TrxDate"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="oracle.jbo.domain.Date"
    ColumnType="DATE"
    AliasName="TRX_DATE"
    Expression="TRX_DATE"
    SQLType="DATE"/>
  <ViewAttribute
    Name="AmountDueOriginal"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="java.lang.Integer"
    ColumnType="NUMBER"
    AliasName="AMOUNT_DUE_ORIGINAL"
    Expression="AMOUNT_DUE_ORIGINAL"
    SQLType="INTEGER"/>
  <ViewAttribute
    Name="AmountDueRemaining"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="java.lang.Integer"
    ColumnType="NUMBER"
    AliasName="AMOUNT_DUE_REMAINING"
    Expression="AMOUNT_DUE_REMAINING"
    SQLType="INTEGER"/>
  <ViewAttribute
    Name="BillToCustomerId"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="15"
    Scale="0"
    Type="java.lang.Integer"
    ColumnType="NUMBER"
    AliasName="BILL_TO_CUSTOMER_ID"
    Expression="BILL_TO_CUSTOMER_ID"
    SQLType="INTEGER"/>
  <ViewAttribute
    Name="ShipDateActual"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="oracle.jbo.domain.Date"
    ColumnType="DATE"
    AliasName="SHIP_DATE_ACTUAL"
    Expression="SHIP_DATE_ACTUAL"
    SQLType="DATE"/>
  <ViewAttribute
    Name="DueDate"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="oracle.jbo.domain.Date"
    ColumnType="DATE"
    AliasName="DUE_DATE"
    Expression="DUE_DATE"
    SQLType="DATE"/>
  <ViewAttribute
    Name="WorkOrder"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="150"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="WORK_ORDER"
    Expression="WORK_ORDER"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="150"/>
    </DesignTime>
  </ViewAttribute>
  <ViewAttribute
    Name="PurchaseOrder"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="50"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="PURCHASE_ORDER"
    Expression="PURCHASE_ORDER"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="50"/>
    </DesignTime>
  </ViewAttribute>
  <ViewAttribute
    Name="BatchId"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="java.lang.Integer"
    ColumnType="NUMBER"
    AliasName="BATCH_ID"
    Expression="BATCH_ID"
    SQLType="INTEGER"/>
  <ViewAttribute
    Name="InvoiceSent"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="240"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="INVOICE_SENT"
    Expression="INVOICE_SENT"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="240"/>
    </DesignTime>
  </ViewAttribute>
  <ViewLinkAccessor
    Name="SubmittedBatchesForAccountStatusView"
    ViewLink="com.rmi.applicationEntry.adfbc.views.links.AccountStatusSubmittedBatchesLogicalLink"
    Type="oracle.jbo.RowIterator"
    IsUpdateable="false"/>
  <ResourceBundle>
    <PropertiesBundle
      PropertiesFile="com.rmi.applicationEntry.adfbc.ModelBundle"/>
  </ResourceBundle>
</ViewObject>
